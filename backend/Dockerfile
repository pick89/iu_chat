# ğŸ› ï¸ Stage 1: Build the backend
FROM rust:1.71 as builder                    
WORKDIR /app
COPY backend/ ./                             

# ğŸ§° Install system dependencies for certain crates (like OpenSSL)
RUN apt-get update && apt-get install -y pkg-config libssl-dev

# ğŸ—ï¸ Build the Rust app in release mode
RUN cargo build --release 

# ğŸš€ Stage 2: Runtime container
FROM debian:bullseye-slim                    

# ğŸ—‚ï¸ Copy the built binary from the builder stage
COPY --from=builder /app/target/release/backend /usr/local/bin/backend

# ğŸŒ Expose the port your app uses
EXPOSE 8080

# â–¶ï¸ Start the application when the container runs
CMD ["bencher"]
# You can replace this with a custom run if needed:
# CMD ["bencher", "--host", "0.0.0.0"]
